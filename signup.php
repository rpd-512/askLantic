<?php
require_once "libs.php";
if(isAuth()[0]){
    header("Location: index.php");
}
if(isset($_POST["user"]) and isset($_POST["mail"]) and isset($_POST["pswd"])){
    if(strlen($_POST['pswd']) < 8){header("Location: signup.php");exit();}
    if(strlen($_POST['user']) < 3 or strlen($_POST['user']) > 20){header("Location: signup.php");exit();}
    if(! filter_var($_POST['mail'], FILTER_VALIDATE_EMAIL)){header("Location: signup.php");exit();}
    $usrn = $_POST['user'];
    $mail = $_POST['mail'];
    $raw_data = $pdo->query("select * from askLantic__userData");
    while ($data = $raw_data->fetch(PDO::FETCH_ASSOC))
    {
        if(strtolower($data['usern']) == strtolower($usrn)){
            header("Location: signup.php");
            return;
        }
        if(strtolower($data['email']) == strtolower($mail)){
            header("Location: signup.php");
            return;
        }
    }
    $qry = "insert into askLantic__userData (usern,email,paswd) VALUES (:user, :mail, :pswd)";
    $raw_data = $pdo->prepare($qry);
    $raw_data->execute(array(
        ':user' => htmlentities($_POST["user"]),
        ':mail' => htmlentities($_POST["mail"]),
        ':pswd' => md5($_POST["pswd"]."ASKmeBOIS@69069")
    ));
    setcookie("userId",md5(strtolower($_POST["user"]).md5($_POST["pswd"]."ASKmeBOIS@69069")."ASKmeBOIS@69069"),time()+60*60*24*30);
    header("Location: index.php");
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>AskLantic || Ask your stuff here</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link href='https://fonts.googleapis.com/css?family=Days One' rel='stylesheet'>
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <link rel="stylesheet" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="js/index.js"></script>
    </head>
    <body onload="$('#ldScrn')[0].remove()" style='text-align:unset;'>
        <div id='ldScrn'>
            <svg width="250" height="250" viewBox="0 0 604 603" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M302 603C468.514 603 603.5 468.014 603.5 301.5C603.5 134.986 468.514 0 302 0C135.486 0 0.5 134.986 0.5 301.5C0.5 468.014 135.486 603 302 603Z" fill="#3F3D56"/>
                <path opacity="0.05" d="M302 550.398C439.462 550.398 550.898 438.962 550.898 301.5C550.898 164.038 439.462 52.6021 302 52.6021C164.537 52.6021 53.1021 164.038 53.1021 301.5C53.1021 438.962 164.537 550.398 302 550.398Z" fill="black"/>
                <path opacity="0.05" d="M302 505.494C414.663 505.494 505.994 414.163 505.994 301.5C505.994 188.837 414.663 97.5064 302 97.5064C189.337 97.5064 98.0064 188.837 98.0064 301.5C98.0064 414.163 189.337 505.494 302 505.494Z" fill="black"/>
                <path opacity="0.05" d="M302 447.76C382.777 447.76 448.26 382.277 448.26 301.5C448.26 220.723 382.777 155.24 302 155.24C221.223 155.24 155.74 220.723 155.74 301.5C155.74 382.277 221.223 447.76 302 447.76Z" fill="black"/>
                <path d="M304.76 533.012C324.159 533.012 339.885 516.958 339.885 497.155C339.885 477.352 324.159 461.299 304.76 461.299C285.36 461.299 269.634 477.352 269.634 497.155C269.634 516.958 285.36 533.012 304.76 533.012Z" fill="#3895BF"/>
                <path d="M300.997 123.003C246.1 123.399 201.151 168.938 200.371 224.973C200.364 225.49 200.36 229.128 200.361 233.886C200.361 240.862 203.076 247.552 207.908 252.485C212.74 257.418 219.294 260.19 226.128 260.19C229.515 260.19 232.87 259.507 235.999 258.183C239.128 256.858 241.971 254.917 244.365 252.471C246.76 250.024 248.658 247.12 249.952 243.924C251.246 240.728 251.911 237.304 251.908 233.845C251.905 230.609 251.904 228.369 251.904 228.231C251.902 219.571 254.109 211.06 258.307 203.534C262.505 196.009 268.55 189.729 275.847 185.311C283.144 180.894 291.442 178.492 299.924 178.341C308.406 178.19 316.781 180.296 324.224 184.451C331.668 188.606 337.923 194.668 342.375 202.04C346.827 209.411 349.323 217.839 349.617 226.494C349.91 235.149 347.992 243.733 344.05 251.401C340.108 259.07 334.278 265.559 327.135 270.23L327.144 270.241C327.144 270.241 290.469 294.342 279.288 327.405L279.297 327.407C277.331 334.181 276.335 341.208 276.339 348.273C276.339 351.177 276.507 376.585 276.83 397.207C276.943 404.323 279.792 411.108 284.762 416.098C289.732 421.089 296.424 423.885 303.396 423.883C306.899 423.883 310.367 423.176 313.602 421.802C316.836 420.429 319.772 418.416 322.241 415.879C324.711 413.343 326.664 410.333 327.99 407.023C329.315 403.713 329.986 400.168 329.965 396.593C329.852 377.706 329.792 355.715 329.792 354.119C329.792 333.817 348.978 313.589 364.737 300.398C382.885 285.209 395.944 264.508 401.19 241.158C402.35 236.351 402.99 231.428 403.098 226.477C403.098 212.826 400.452 199.309 395.312 186.706C390.171 174.103 382.639 162.662 373.148 153.044C363.658 143.426 352.396 135.819 340.013 130.664C327.63 125.508 314.37 122.904 300.997 123.003Z" fill="#3895BF"/>
            </svg>
        </div>
        <div class="authHead">
            <h1 onclick="location.href='index.php'" onmouseover="this.style.cursor='pointer'">AskLantic</h1>
            <div id="err"></div>
            <div class="sign up">
                <form autocomplete="off" method="post">
                    <h1>Sign up</h1>
                    <input placeholder="Username" name="user" id="us">
                    <input placeholder="Email" name="mail" id="ml">
                    <input placeholder="Password" type="password" name="pswd" id="ps">
                    <input placeholder="Confirm Password" type="password" id="cp">
                    <button type="submit" id="subm" onclick="return sign('up');">Sign up</button>
                    <input type="button" value="Back" onclick="location.href='index.php'">
                </form>
            </div>
        </div>
        <svg width="400" height="225" viewBox="0 0 882 525" fill="none" xmlns="http://www.w3.org/2000/svg" class="helloChar">
            <g id="undraw_social_friends_nsbv 1" clip-path="url(#clip0)">
            <path id="Vector" d="M138.343 78.5538C134.973 83.0562 132.933 88.4131 132.454 94.0164C131.768 100.837 129.771 111.746 123.96 117.48C115.106 126.217 112.155 132.769 112.155 132.769L115.106 136.045C115.106 129.493 119.041 128.401 119.041 128.401L118.057 136.045C144.618 161.162 203.644 138.229 203.644 138.229L201.676 118.572C206.595 120.757 208.562 136.045 208.562 136.045L216.432 133.861C216.432 133.861 202.66 109.836 193.806 87.9952C184.952 66.1542 171.18 71.6145 171.18 71.6145C154.948 62.9388 144.227 70.9841 138.343 78.5538Z" fill="#2F2E41"/>
            <g id="helloHand" clip-path="url(#clip1)">
            <path id="Vector_2" d="M230.75 89.8041L240.289 27.4859C240.289 27.4859 230.114 2.68574 247.284 0.142136C264.453 -2.40146 253.007 30.0295 253.007 30.0295L247.284 89.8041H230.75Z" fill="#FFB9B9"/>
            <path id="Vector_3" d="M209.766 165.476L235.202 133.045L253.007 89.168L228.207 79.63L218.032 115.876L200.227 137.497L199.591 141.312L209.766 165.476Z" fill="#6C63FF"/>
            </g>
            <g id="Group 4">
            <path id="Vector_4" d="M154.442 128.594C162.709 140.676 152.534 147.671 152.534 147.671L148.083 180.738C148.083 180.738 195.776 185.189 204.042 178.83C212.309 172.471 194.504 151.487 188.145 149.579C181.786 147.671 180.514 121.599 180.514 121.599L154.442 128.594Z" fill="#FFB9B9"/>
            <g id="Group 3">
            <path id="Vector_5" d="M277.171 365.785L286.074 393.129L298.156 382.954L291.797 361.334L277.171 365.785Z" fill="#FFB9B9"/>
            <path id="Vector_6" d="M162.709 249.415L165.888 292.021L242.832 293.928L276.535 370.872L294.976 363.241C294.976 363.241 273.991 290.749 264.453 267.856C254.914 244.964 218.668 261.497 218.668 261.497L215.489 255.138L162.709 249.415Z" fill="#2F2E41"/>
            <path id="Vector_7" d="M282.258 388.042C282.258 388.042 283.53 408.39 285.438 409.662C287.345 410.934 301.971 408.39 301.971 408.39C301.971 408.39 306.366 409.367 324.228 404.575C344.309 399.188 321.684 391.221 321.684 391.221C321.684 391.221 307.058 381.683 300.699 377.231C294.34 372.78 289.889 382.319 289.889 382.319C291.161 386.134 282.258 388.042 282.258 388.042Z" fill="#2F2E41"/>
            <path id="Vector_8" d="M223.119 382.954C226.299 388.042 226.935 414.114 226.935 414.114L249.191 400.124L242.832 377.231L223.119 382.954Z" fill="#FFB9B9"/>
            <path id="Vector_9" d="M191.96 246.236C191.96 246.236 163.981 246.236 148.719 255.138C143.813 258 142.39 263.161 142.717 268.848C143.571 283.703 155.704 295.435 170.556 296.354L213.581 299.016C207.222 316.821 221.848 386.134 221.848 386.134L244.74 382.954C244.74 382.954 241.561 359.426 242.196 358.154C242.832 356.882 248.555 307.282 244.74 281.21C240.925 255.138 188.781 265.949 188.781 265.949L191.96 246.236Z" fill="#2F2E41"/>
            <path id="Vector_10" d="M225.663 408.39C225.663 408.39 223.755 426.832 224.391 429.375C225.027 431.919 251.099 433.191 274.627 426.196C298.156 419.201 271.448 411.57 271.448 411.57C271.448 411.57 255.55 400.76 251.099 396.944C246.648 393.129 240.289 402.031 240.289 402.031C239.017 407.755 225.663 408.39 225.663 408.39Z" fill="#2F2E41"/>
            <path id="Vector_11" d="M155.686 144.283L130.596 140.358L127.734 167.384C127.734 167.384 129.006 227.795 127.734 238.605C126.462 249.415 149.355 261.497 149.355 261.497C149.355 261.497 182.422 258.954 188.781 255.774C195.14 252.595 215.489 258.954 215.489 258.954C217.755 259.08 220.025 258.756 222.166 258C225.981 256.728 212.309 166.112 212.309 166.112L200.227 138.133L185.601 143.856L181.15 164.84L155.686 144.283Z" fill="#6C63FF"/>
            <path id="Vector_12" d="M129.615 214.843L192.614 217.215C192.614 217.215 216.093 204.279 220.577 221.046C225.062 237.814 191.537 230.14 191.537 230.14L131.5 231.269L129.615 214.843Z" fill="#FFB9B9"/>
            <path id="Vector_13" d="M135.047 210.307L164.299 212.215L168.114 231.928C168.114 231.928 132.503 231.292 118.514 230.656C104.524 230.02 118.514 170.882 120.421 153.076C122.329 135.271 131.868 140.358 131.868 140.358L137.591 144.81L135.047 210.307Z" fill="#6C63FF"/>
            <path id="Vector_14" opacity="0.15" d="M140.135 203.948L165.571 214.123L137.591 208.399L135.683 172.153L140.135 203.948Z" fill="black"/>
            </g>
            </g>
            <g id="Group 5">
            <path id="Vector_15" d="M186.577 115.09C188.603 102.611 180.127 90.8518 167.647 88.8266C155.167 86.8014 143.409 95.2767 141.384 107.757C139.358 120.237 147.834 131.995 160.314 134.02C172.793 136.046 184.552 127.57 186.577 115.09Z" fill="#FFB9B9"/>
            <path id="Vector_16" d="M188.155 103.804L146.155 104.804L141.155 83.804H188.155V103.804Z" fill="#2F2E41"/>
            </g>
            </g>
            <defs>
            <clipPath id="clip0">
            <rect width="881.389" height="697.508" fill="white"/>
            </clipPath>
            <clipPath id="clip1">
            <rect width="57.1532" height="165.476" fill="white" transform="translate(199.591)"/>
            </clipPath>
            </defs>
        </svg>
    </body>
</html>
