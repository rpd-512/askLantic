<?php
require_once "libs.php";
session_start();
$cmnd = "";
$userData = [];
if (isset($_SESSION['cmnd'])) {
    $cmnd = $_SESSION['cmnd'];
    unset($_SESSION['cmnd']);
}
if (isset(isAuth()[1])) {$userData = isAuth()[1];}
$noQry = false;
if(! isset($_GET['query']) or $_GET['query'] == ""){
    $noQry = true;
}

?>
<!DOCTYPE html>
<html lang='en'>
    <head>
        <title>AskLantic || Ask your stuff here</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link href='https://fonts.googleapis.com/css?family=Days One' rel='stylesheet'>
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <link rel="stylesheet" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="js/index.js"></script>
    </head>
    <body onload="$('#ldScrn')[0].remove()">
        <div id='ldScrn'>
            <svg width="250" height="250" viewBox="0 0 604 603" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M302 603C468.514 603 603.5 468.014 603.5 301.5C603.5 134.986 468.514 0 302 0C135.486 0 0.5 134.986 0.5 301.5C0.5 468.014 135.486 603 302 603Z" fill="#3F3D56"/>
                <path opacity="0.05" d="M302 550.398C439.462 550.398 550.898 438.962 550.898 301.5C550.898 164.038 439.462 52.6021 302 52.6021C164.537 52.6021 53.1021 164.038 53.1021 301.5C53.1021 438.962 164.537 550.398 302 550.398Z" fill="black"/>
                <path opacity="0.05" d="M302 505.494C414.663 505.494 505.994 414.163 505.994 301.5C505.994 188.837 414.663 97.5064 302 97.5064C189.337 97.5064 98.0064 188.837 98.0064 301.5C98.0064 414.163 189.337 505.494 302 505.494Z" fill="black"/>
                <path opacity="0.05" d="M302 447.76C382.777 447.76 448.26 382.277 448.26 301.5C448.26 220.723 382.777 155.24 302 155.24C221.223 155.24 155.74 220.723 155.74 301.5C155.74 382.277 221.223 447.76 302 447.76Z" fill="black"/>
                <path d="M304.76 533.012C324.159 533.012 339.885 516.958 339.885 497.155C339.885 477.352 324.159 461.299 304.76 461.299C285.36 461.299 269.634 477.352 269.634 497.155C269.634 516.958 285.36 533.012 304.76 533.012Z" fill="#3895BF"/>
                <path d="M300.997 123.003C246.1 123.399 201.151 168.938 200.371 224.973C200.364 225.49 200.36 229.128 200.361 233.886C200.361 240.862 203.076 247.552 207.908 252.485C212.74 257.418 219.294 260.19 226.128 260.19C229.515 260.19 232.87 259.507 235.999 258.183C239.128 256.858 241.971 254.917 244.365 252.471C246.76 250.024 248.658 247.12 249.952 243.924C251.246 240.728 251.911 237.304 251.908 233.845C251.905 230.609 251.904 228.369 251.904 228.231C251.902 219.571 254.109 211.06 258.307 203.534C262.505 196.009 268.55 189.729 275.847 185.311C283.144 180.894 291.442 178.492 299.924 178.341C308.406 178.19 316.781 180.296 324.224 184.451C331.668 188.606 337.923 194.668 342.375 202.04C346.827 209.411 349.323 217.839 349.617 226.494C349.91 235.149 347.992 243.733 344.05 251.401C340.108 259.07 334.278 265.559 327.135 270.23L327.144 270.241C327.144 270.241 290.469 294.342 279.288 327.405L279.297 327.407C277.331 334.181 276.335 341.208 276.339 348.273C276.339 351.177 276.507 376.585 276.83 397.207C276.943 404.323 279.792 411.108 284.762 416.098C289.732 421.089 296.424 423.885 303.396 423.883C306.899 423.883 310.367 423.176 313.602 421.802C316.836 420.429 319.772 418.416 322.241 415.879C324.711 413.343 326.664 410.333 327.99 407.023C329.315 403.713 329.986 400.168 329.965 396.593C329.852 377.706 329.792 355.715 329.792 354.119C329.792 333.817 348.978 313.589 364.737 300.398C382.885 285.209 395.944 264.508 401.19 241.158C402.35 236.351 402.99 231.428 403.098 226.477C403.098 212.826 400.452 199.309 395.312 186.706C390.171 174.103 382.639 162.662 373.148 153.044C363.658 143.426 352.396 135.819 340.013 130.664C327.63 125.508 314.37 122.904 300.997 123.003Z" fill="#3895BF"/>
            </svg>
        </div>
        <div class="homeHead" style="height:180px;">
                <h1 onclick="location.href='index.php'" onmouseover="this.style.cursor='pointer'">AskLantic</h1><br>
                <div style='margin-top:45px;'>
                <form method='get' action='search.php'>
                    <input placeholder="Search for a tag (seperate tags with spaces)" name='query'><button type='submit' onclick='if(document.getElementsByName("query")[0].value == ""){return false;}'><img src="images/search.svg" alt='search icon'></button>
                </form>
                </div>
                <?php
                if($userData != []){
                    $profPic = $userData["prfpc"];
                    if($profPic == ""){$profPic = "images/default.png";}
                    else{$profPic = "profile_picture/".$profPic;}
                    echo "
                    <div class='menu' onmouseover='document.getElementsByClassName(\"menuOptions\")[0].style.display=\"block\"' onmouseout='document.getElementsByClassName(\"menuOptions\")[0].style.display=\"none\"'>
                        <button class='prof'>
                            <img src='".$profPic."' alt='profile picture' onerror='this.src=\"images/default.png\"'>
                        </button>

                        <div class='menuOptions'>
                            <button onclick='location.href=\"profile.php\"'>Profile</button><br>
                            <button onclick='location.href=\"achievements.php\"'>Achievements</button><br>
                            <button onclick='location.href=\"notifications.php\"'>Notification</button><br>
                            <button onclick='lgout()'>Logout</button><br>
                        </div>
                    </div>";
                }
                ?>
        </div>
        <?php
        if($noQry){
            echo "
            <div class='srchHlp'>
                <span>
                    Search for tags,<br>
                    seperate them using spaces
                </span>
            </div>
            ";
        }
        else{
            $tagArr = (explode(" ",$_GET['query']));
            $srchQry = "";
            foreach($tagArr as $t){
                $srchQry.="locate('".$t."',tags) or ";
                $lstTg = $t;
            }
            $srchQry.="locate('".$lstTg."',tags)";
            echo '<div class="srchRslt"><div class="homeBase"><div class="hotQues">';
            $raw_data = $pdo->query("select * from askLantic__questions where isCmnt is NULL and ".$srchQry);
            $exst = false;
            while ($data = $raw_data->fetch(PDO::FETCH_ASSOC)){    
                $exst = true;
                $upvt = getVoteCount($data['quesId']);
                echo '
                <a href="questions.php?q='.md5($data['quesId']."QuestionOfFire@314159265").'" class="menuQues">
                        <div class="upvt">
                            <svg aria-hidden="true" class="m0 svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36" fill="rgb(50,120,150"><path d="M2 26h32L18 10 2 26z"></path></svg>
                            <p>'.$upvt.'</p>
                        </div>
                        <div class="ques">
                            <p class="title">'.$data['titl'].'</p>
                            <p class="descr">'.str_replace("[I]","",str_replace("[U]","",str_replace("[C]","",str_replace("[B]","",str_replace("[>]","",str_replace("[!]","",$data['ques'])))))).'</p>
                        </div>
                    </a>
                    ';
                }

            echo "</div></div></div>";
            if(!$exst){
                echo "
                <div class='srchHlp'>
                    <span>
                        No results :-(
                    </span>
                </div>
            ";   
            }
        }
        ?>
        <svg width="250" height="300" viewBox="0 0 785 783" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="Frame 1">
            <g id="searchHand">
            <path id="Vector" d="M313.14 177.612C311.693 178.936 310.732 180.706 310.41 182.641C310.089 184.576 310.425 186.562 311.366 188.283C314.518 194.257 322.844 204.2 344.612 211.498L428.918 239.761L510.974 274.818C510.974 274.818 534.266 277.999 541.5 260.797C548.734 243.595 518.69 260.797 518.69 260.797C518.69 260.797 455.952 227.687 436.603 221.2C418.565 215.153 334.664 158.16 313.14 177.612Z" fill="#FFB8B8"/>
            <path id="Vector_2" d="M610.445 106.748C620.403 98.3961 632.588 93.1015 645.518 91.5078C658.448 89.9142 671.565 92.0902 683.274 97.7711C694.982 103.452 704.777 112.393 711.466 123.506C718.155 134.619 721.45 147.425 720.951 160.365C720.451 173.305 716.177 185.822 708.651 196.393C701.124 206.963 690.669 215.131 678.556 219.903C666.444 224.675 653.198 225.845 640.429 223.271C627.66 220.697 615.919 214.489 606.634 205.404L524.192 274.545C522.938 275.599 521.313 276.115 519.677 275.979C518.04 275.842 516.524 275.065 515.464 273.819C514.403 272.572 513.885 270.957 514.022 269.33C514.159 267.703 514.94 266.197 516.195 265.143L516.204 265.136L598.646 195.994C589.069 182.332 584.97 165.608 587.153 149.099C589.335 132.59 597.642 117.486 610.445 106.748ZM615.76 189.336C622.182 196.902 630.718 202.404 640.287 205.148C649.856 207.892 660.028 207.754 669.518 204.751C679.009 201.749 687.39 196.016 693.602 188.28C699.814 180.543 703.579 171.149 704.42 161.285C705.26 151.422 703.139 141.532 698.325 132.867C693.511 124.202 686.22 117.15 677.373 112.603C668.526 108.057 658.522 106.22 648.625 107.325C638.728 108.429 629.383 112.426 621.771 118.81H621.771C616.717 123.048 612.553 128.235 609.516 134.073C606.478 139.911 604.628 146.287 604.07 152.836C603.511 159.385 604.256 165.979 606.262 172.242C608.268 178.504 611.495 184.313 615.76 189.336Z" fill="#3F3D56"/>
            </g>
            <g id="searchHead">
            <path id="Vector_3" d="M306.537 133.124C332.499 133.124 353.546 111.685 353.546 85.2379C353.546 58.7912 332.499 37.3519 306.537 37.3519C280.574 37.3519 259.527 58.7912 259.527 85.2379C259.527 111.685 280.574 133.124 306.537 133.124Z" fill="#FF6584"/>
            <path id="Vector_4" d="M307.827 143.411C326.797 143.411 342.176 127.746 342.176 108.421C342.176 89.0968 326.797 73.4312 307.827 73.4312C288.856 73.4312 273.477 89.0968 273.477 108.421C273.477 127.746 288.856 143.411 307.827 143.411Z" fill="#FFB8B8"/>
            <path id="Vector_5" d="M281.999 0C285.523 5.1407 290.79 8.82959 296.826 10.3829C307.194 13.211 296.911 29.082 296.911 29.082C296.911 29.082 300.65 23.3107 295.257 17.1988C289.863 11.0869 281.183 6.90827 281.999 0Z" fill="#FF6584"/>
            <path id="Vector_6" d="M298.748 46.2345C305.984 46.2345 311.849 40.2596 311.849 32.8892C311.849 25.5188 305.984 19.5439 298.748 19.5439C291.513 19.5439 285.647 25.5188 285.647 32.8892C285.647 40.2596 291.513 46.2345 298.748 46.2345Z" fill="#FF6584"/>
            <path id="Vector_7" d="M282.022 44.0748C292.702 39.9598 310.485 37.8734 319.634 39.2996L318.38 29.9666C309.584 34.5972 291.882 36.7734 280.767 34.7417L282.022 44.0748Z" fill="#3F3D56"/>
            <path id="Vector_8" d="M302.688 47.4155C302.688 47.4155 316.073 70.0947 347.198 78.5847C378.323 87.0746 347.452 134.719 347.452 134.719C347.452 134.719 358.678 117.394 342.487 99.0459C326.295 80.698 300.238 68.154 302.688 47.4155Z" fill="#FF6584"/>
            <path id="Vector_9" d="M301.625 46.0374C301.625 46.0374 288.767 77.1883 274.65 80.1334C260.533 83.0785 261.603 132.3 283.68 139.681C283.68 139.681 267.582 110.825 281.342 91.473C295.102 72.1208 303.794 56.8225 301.625 46.0374Z" fill="#FF6584"/>
            </g>
            <g id="searchBody">
            <g id="Group 4">
            <path id="Vector_10" d="M287 407H264V733H287V407Z" fill="#1A237E"/>
            <g id="Group 3">
            <path id="Vector_11" d="M84 407H59V733H84V407Z" fill="#1A237E"/>
            <path id="Vector_12" d="M353.92 396.538H0.621536V415.472H353.92V396.538Z" fill="#536DFE"/>
            </g>
            </g>
            <g id="Group 9">
            <g id="Group 10">
            <path id="Vector_13" d="M343.023 628.154C343.023 628.154 350.01 642.226 347.905 647.842C345.8 653.457 334.763 685.878 334.763 685.878C334.763 685.878 346.515 732.84 337.989 731.795C329.463 730.75 298.608 699.068 299.975 687.489L303.908 654.197L294.356 661.837L282.198 642.725L299.143 621.307C299.143 621.307 317.339 601.511 323.022 602.208C328.706 602.904 343.023 628.154 343.023 628.154Z" fill="#2F2E41"/>
            <g id="Group 8">
            <g id="Group 7">
            <g id="Group 2">
            <path id="Vector_14" d="M313.275 135.521L302.58 165.047L317.869 169.858L320.016 212.705L282.109 191.906L263.016 170.477L260.634 154.032C260.634 154.032 275.357 151.431 280.71 118.314L313.275 135.521Z" fill="#FFB8B8"/>
            <path id="Vector_15" d="M271.66 158.321C271.66 158.321 264.331 147.143 259.897 148.068C255.463 148.993 231.22 148.435 227.353 156.772C223.485 165.108 241.903 251.59 238.944 264.443C235.984 277.296 220.266 373.755 233.792 381.286C247.318 388.817 263.131 352.576 263.131 352.576C263.131 352.576 305.654 334.293 341.745 346.059C377.836 357.824 366.757 341.782 366.757 341.782C366.757 341.782 340.901 316.587 344.834 283.295C348.766 250.003 350.529 247.282 343.884 230.315C343.884 230.315 342.698 203.738 343.553 196.5C344.408 189.263 349.697 181.101 345.776 177.683C341.855 174.266 301.159 164.873 301.159 164.873C301.159 164.873 321.79 173.275 312.409 179.467C303.028 185.66 271.66 158.321 271.66 158.321Z" fill="#3F3D56"/>
            </g>
            <path id="Vector_16" d="M235.625 152.72C237.441 151.979 239.453 151.867 241.34 152.404C243.226 152.941 244.879 154.094 246.032 155.68C250.089 161.084 255.527 172.863 252.834 195.661L242.405 283.957L239.081 373.124C239.081 373.124 241.228 415.971 222.584 415.155C203.94 414.338 223.108 374.103 223.108 374.103C223.108 374.103 219.947 303.231 222.34 282.966C224.572 264.075 208.847 163.86 235.625 152.72Z" fill="#FFB8B8"/>
            </g>
            <g id="Group 6">
            <g id="Group 5">
            <path id="Vector_17" d="M385.047 382.203C385.047 382.203 451.929 450.605 434.695 486.672C417.461 522.739 333.353 648.995 333.353 648.995L310.853 619.805C310.853 619.805 332.969 603.426 343.269 565.041C353.57 526.656 376.883 500.145 383.763 490.709C390.644 481.273 319.158 415.243 325.472 398.396C331.787 381.549 385.047 382.203 385.047 382.203Z" fill="#FFB8B8"/>
            <path id="Vector_18" opacity="0.1" d="M385.047 382.203C385.047 382.203 451.929 450.605 434.695 486.672C417.461 522.739 333.353 648.995 333.353 648.995L310.853 619.805C310.853 619.805 332.969 603.426 343.269 565.041C353.57 526.656 376.883 500.145 383.763 490.709C390.644 481.273 319.158 415.243 325.472 398.396C331.787 381.549 385.047 382.203 385.047 382.203Z" fill="black"/>
            <path id="Vector_19" d="M329.735 398.918L334.222 409.747L353.068 494.289C353.068 494.289 360.568 504.019 358.228 536.038C355.887 568.056 396.036 691.92 396.036 691.92L397.393 717.049L373.236 714.089L356.762 682.701C356.762 682.701 350.576 649.637 332.51 619.523C314.443 589.409 314.466 515.99 314.466 515.99L265.844 402.835L304.104 384.03L329.735 398.918Z" fill="#FFB8B8"/>
            <path id="Vector_20" d="M387.799 676.226C387.799 676.226 395.075 675.649 396.154 678.718C397.233 681.787 418.985 741.722 418.985 741.722C418.985 741.722 460.353 782.034 440.118 782.491C419.882 782.948 385.949 777.321 380.212 764.87C374.475 752.42 367.83 735.452 367.83 735.452L365.778 752.822L349.752 742.047C349.752 742.047 340.789 683.68 351.249 680.557C361.709 677.433 387.799 676.226 387.799 676.226Z" fill="#2F2E41"/>
            </g>
            <path id="Vector_21" d="M363.402 345.776C363.402 345.776 380.336 361.067 378.744 362.34C377.152 363.614 388.349 366.454 386.244 372.07C384.139 377.686 395.731 389.386 390.047 388.689C384.363 387.992 362.311 379.416 337.919 402.858L333.656 402.336L334.222 409.747C334.222 409.747 316.551 388.492 270.897 421.076C270.897 421.076 255.78 414.818 257.884 409.202C259.989 403.586 233.333 397.382 247.725 360.967C262.117 324.552 306.68 325.608 306.68 325.608L363.402 345.776Z" fill="#2F2E41"/>
            </g>
            </g>
            </g>
            </g>
            </g>
            </g>
        </svg>
    </body>
</html>
