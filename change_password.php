<?php
require_once "libs.php";
session_start();
if(isset(isAuth()[1])){$userData = isAuth()[1];}
else{header("Location: index.php");exit();}
if(isset($_POST['user']) and isset($_POST['pswd']) and isset($_POST['cpwd'])){
    if(! isValid($_POST['user'],$_POST['pswd'])){header("Location: change_password.php");exit();}
    $qry = 'update askLantic__userData SET paswd=:pwd where userId='.$userData['userId'].';';
    $raw_data = $pdo->prepare($qry);
    $raw_data->execute(array(':pwd' => md5($_POST['cpwd']."ASKmeBOIS@69069")));
    setcookie("userId",md5(strtolower($_POST["user"]).md5($_POST["cpwd"]."ASKmeBOIS@69069")."ASKmeBOIS@69069"),time()+60*60*24*30);
    $_SESSION['cmnd'] = "Password updated successfully";
    header("Location: edit_profile.php");
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>AskLantic || Ask your stuff here</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link href='https://fonts.googleapis.com/css?family=Days One' rel='stylesheet'>
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <link rel="stylesheet" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="js/index.js"></script>
    </head>
    <body onload="$('#ldScrn')[0].remove()">
        <div id='ldScrn'>
            <svg width="250" height="250" viewBox="0 0 604 603" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M302 603C468.514 603 603.5 468.014 603.5 301.5C603.5 134.986 468.514 0 302 0C135.486 0 0.5 134.986 0.5 301.5C0.5 468.014 135.486 603 302 603Z" fill="#3F3D56"/>
                <path opacity="0.05" d="M302 550.398C439.462 550.398 550.898 438.962 550.898 301.5C550.898 164.038 439.462 52.6021 302 52.6021C164.537 52.6021 53.1021 164.038 53.1021 301.5C53.1021 438.962 164.537 550.398 302 550.398Z" fill="black"/>
                <path opacity="0.05" d="M302 505.494C414.663 505.494 505.994 414.163 505.994 301.5C505.994 188.837 414.663 97.5064 302 97.5064C189.337 97.5064 98.0064 188.837 98.0064 301.5C98.0064 414.163 189.337 505.494 302 505.494Z" fill="black"/>
                <path opacity="0.05" d="M302 447.76C382.777 447.76 448.26 382.277 448.26 301.5C448.26 220.723 382.777 155.24 302 155.24C221.223 155.24 155.74 220.723 155.74 301.5C155.74 382.277 221.223 447.76 302 447.76Z" fill="black"/>
                <path d="M304.76 533.012C324.159 533.012 339.885 516.958 339.885 497.155C339.885 477.352 324.159 461.299 304.76 461.299C285.36 461.299 269.634 477.352 269.634 497.155C269.634 516.958 285.36 533.012 304.76 533.012Z" fill="#3895BF"/>
                <path d="M300.997 123.003C246.1 123.399 201.151 168.938 200.371 224.973C200.364 225.49 200.36 229.128 200.361 233.886C200.361 240.862 203.076 247.552 207.908 252.485C212.74 257.418 219.294 260.19 226.128 260.19C229.515 260.19 232.87 259.507 235.999 258.183C239.128 256.858 241.971 254.917 244.365 252.471C246.76 250.024 248.658 247.12 249.952 243.924C251.246 240.728 251.911 237.304 251.908 233.845C251.905 230.609 251.904 228.369 251.904 228.231C251.902 219.571 254.109 211.06 258.307 203.534C262.505 196.009 268.55 189.729 275.847 185.311C283.144 180.894 291.442 178.492 299.924 178.341C308.406 178.19 316.781 180.296 324.224 184.451C331.668 188.606 337.923 194.668 342.375 202.04C346.827 209.411 349.323 217.839 349.617 226.494C349.91 235.149 347.992 243.733 344.05 251.401C340.108 259.07 334.278 265.559 327.135 270.23L327.144 270.241C327.144 270.241 290.469 294.342 279.288 327.405L279.297 327.407C277.331 334.181 276.335 341.208 276.339 348.273C276.339 351.177 276.507 376.585 276.83 397.207C276.943 404.323 279.792 411.108 284.762 416.098C289.732 421.089 296.424 423.885 303.396 423.883C306.899 423.883 310.367 423.176 313.602 421.802C316.836 420.429 319.772 418.416 322.241 415.879C324.711 413.343 326.664 410.333 327.99 407.023C329.315 403.713 329.986 400.168 329.965 396.593C329.852 377.706 329.792 355.715 329.792 354.119C329.792 333.817 348.978 313.589 364.737 300.398C382.885 285.209 395.944 264.508 401.19 241.158C402.35 236.351 402.99 231.428 403.098 226.477C403.098 212.826 400.452 199.309 395.312 186.706C390.171 174.103 382.639 162.662 373.148 153.044C363.658 143.426 352.396 135.819 340.013 130.664C327.63 125.508 314.37 122.904 300.997 123.003Z" fill="#3895BF"/>
            </svg>
        </div>
        <div class="homeHead" style="height:120px;position:sticky;top:7px;">
                <h1 onclick="location.href='index.php'" onmouseover="this.style.cursor='pointer'">AskLantic</h1>
                <p>Change password</p>
        </div>
        <div id="err">_</div>
        <div class="chngPswd">
            <form method="post">
                <input type="hidden" value="<?= $userData['usern'] ?>" id="us" name="user">
                <input placeholder="Current password" id="ps" type="password" name="pswd">
                <input placeholder="New password" type="password" id="np" name="cpwd">
                <input placeholder="Confirm password" type="password" id="cp">
                <input type="submit" id="subm" onclick="return chngPswd();" value="Change">
                <input type="button" value="Back" onclick="location.href='edit_profile.php'">
            </form>
        </div>

        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="453.36 48 304.49 670.4" width="200" height="200" class="pswdChar">
            <g id="undraw_unlock_24mb 1">
            <g id="passBody1">
            <path id="Vector" d="M696.107 53.3001C696.107 53.3001 673.805 33.3052 643.813 70.9878C613.821 108.67 566.91 127.127 556.143 141.739C556.143 141.739 600.747 123.282 616.128 115.592C631.509 107.901 630.74 109.44 630.74 109.44C630.74 109.44 609.976 124.051 606.13 138.663C602.285 153.274 605.361 165.579 598.44 180.191C591.519 194.802 730.714 190.188 730.714 190.188C730.714 190.188 744.556 166.348 740.711 141.739C736.866 117.13 739.173 56.3762 696.107 53.3001Z" fill="#2F2E41"/>
            <g id="Group 8">
            <path id="Vector_2" d="M653.925 116.202C653.925 116.202 658.774 150.149 637.99 157.77C617.207 165.39 624.827 175.782 624.827 175.782L656.003 191.024L689.257 180.632L700.342 164.005C700.342 164.005 682.329 159.848 687.179 147.378C692.028 134.907 693.414 130.751 693.414 130.751L653.925 116.202Z" fill="#FFB9B9"/>
            <g id="Group 7">
            <g id="Group 6">
            <g id="Group 3">
            <path id="Vector_3" d="M606.122 405.096C606.122 405.096 583.26 491.695 583.953 533.955C584.646 576.215 593.652 635.103 593.652 635.103C593.652 635.103 595.037 660.736 592.959 663.507C590.881 666.278 603.351 678.056 603.351 678.056L616.514 670.435L621.363 664.893V660.043C621.363 660.043 613.743 636.488 619.978 617.783C626.213 599.077 629.677 551.968 623.442 537.419L666.395 409.946L606.122 405.096Z" fill="#FFB9B9"/>
            <path id="Vector_4" d="M604.737 666.971C604.737 666.971 596.423 656.579 590.881 660.043C585.338 663.507 576.332 687.062 576.332 687.062C576.332 687.062 545.156 716.852 567.326 718.238C589.495 719.623 599.194 712.002 601.965 706.46C604.737 700.918 630.37 686.369 630.37 686.369C630.37 686.369 627.599 660.043 623.442 659.35C619.285 658.657 613.05 669.742 613.05 669.742L604.737 666.971Z" fill="#2F2E41"/>
            <path id="Vector_5" d="M681.636 410.638V496.544C681.717 506.968 682.411 517.378 683.715 527.72C685.793 542.961 671.937 656.579 671.937 656.579L673.323 676.67L690.643 675.284L692.721 657.965L717.661 581.758C717.661 581.758 725.975 535.341 721.818 518.021C717.661 500.701 743.295 389.855 743.295 389.855L681.636 410.638Z" fill="#FFB9B9"/>
            <path id="Vector_6" d="M667.78 671.821L672.911 670.705C672.911 670.705 676.787 662.121 681.636 664.2C685.049 665.774 688.282 667.711 691.279 669.978L693.414 673.899C693.414 673.899 698.263 684.291 704.498 691.219C710.733 698.147 717.661 713.388 707.27 714.774C696.878 716.159 683.022 716.852 678.865 713.388C674.708 709.924 677.48 704.382 673.323 702.996C669.166 701.61 665.702 697.454 666.395 696.068C667.088 694.683 667.78 671.821 667.78 671.821Z" fill="#2F2E41"/>
            </g>
            <g id="Group 5">
            <path id="Vector_7" d="M741.216 213.193C741.216 213.193 736.367 276.93 737.752 279.701C739.138 282.472 737.752 378.77 737.752 378.77C737.752 378.77 747.451 430.729 734.981 433.5C722.511 436.272 725.282 375.306 725.282 375.306L712.812 294.942L714.197 215.271L741.216 213.193Z" fill="#FFB9B9"/>
            <g id="Group 4">
            <path id="Vector_8" opacity="0.1" d="M741.216 213.193C741.216 213.193 736.367 276.93 737.752 279.701C739.138 282.472 737.752 378.77 737.752 378.77C737.752 378.77 747.451 430.729 734.981 433.5C722.511 436.272 725.282 375.306 725.282 375.306L712.812 294.942L714.197 215.271L741.216 213.193Z" fill="black"/>
            <path id="Vector_9" d="M623.442 163.312L632.593 160.117C632.593 160.117 628.984 166.083 648.382 169.547C667.78 173.011 687.87 174.237 696.877 162.886C696.877 162.886 700.342 161.234 705.191 166.083C710.041 170.933 712.812 169.547 712.812 169.547L709.348 187.56L702.42 220.814L693.414 245.754L667.78 240.212L640.069 220.121L629.677 193.102V168.161L623.442 163.312Z" fill="#3D3DB5"/>
            <path id="Vector_10" d="M707.962 173.011L714.89 168.161C714.89 168.161 738.445 172.318 739.831 183.403L721.818 218.042C725.492 227.681 725.243 238.375 721.125 247.832C714.197 263.767 714.89 267.231 714.89 267.231L710.041 288.014L622.056 294.942C622.056 294.942 618.592 286.629 617.207 285.243C615.821 283.858 615.821 279.008 617.207 279.008C618.592 279.008 617.207 276.93 615.821 274.851C614.436 272.773 613.743 272.08 615.821 269.309C617.9 266.538 612.357 241.597 612.357 241.597V214.578L588.802 183.403C588.802 183.403 597.116 170.933 601.273 169.547C605.429 168.161 625.203 162.697 625.203 162.697L629.677 169.285L635.912 219.428L644.918 249.911L682.839 243.468L697.57 218.735L707.27 189.638L707.962 173.011Z" fill="#3D3DB5"/>
            <path id="Vector_11" d="M734.288 179.246L739.831 183.403C739.831 183.403 744.68 222.199 743.295 224.97C741.909 227.741 717.661 230.513 716.969 229.127C716.276 227.741 734.288 179.246 734.288 179.246Z" fill="#3D3DB5"/>
            <path id="Vector_12" d="M619.978 159.848L626.906 205.572C626.906 205.572 620.671 273.466 622.056 287.321L623.442 291.478C623.442 291.478 620.671 290.093 619.978 292.864C619.285 295.635 619.978 304.641 619.978 304.641C619.978 304.641 615.821 308.798 614.435 331.66C613.05 354.522 596.423 409.253 602.658 411.331C608.893 413.41 646.304 423.801 666.395 421.723C686.486 419.645 758.536 395.397 757.843 389.162C757.15 382.927 722.511 294.942 722.511 294.942C722.511 294.942 716.276 284.55 716.276 283.165C716.276 281.779 724.589 276.237 722.511 270.694C720.433 265.152 709.348 206.958 709.348 206.958L716.969 165.39L706.577 162.619L698.956 202.801C698.956 202.801 669.166 217.35 637.99 204.187L631.063 157.077L619.978 159.848Z" fill="#2F2E41"/>
            </g>
            </g>
            </g>
            <g id="Group 2">
            <path id="Vector_13" opacity="0.1" d="M653.925 116.202C653.925 116.202 658.774 150.149 637.99 157.77C617.207 165.39 624.827 175.782 624.827 175.782L656.003 191.024L689.257 180.632L700.342 164.005C700.342 164.005 682.329 159.848 687.179 147.378C692.028 134.907 693.414 130.751 693.414 130.751L653.925 116.202Z" fill="black"/>
            <path id="Vector_14" d="M681.636 140.064C698.641 140.064 712.426 126.279 712.426 109.274C712.426 92.2693 698.641 78.484 681.636 78.484C664.631 78.484 650.846 92.2693 650.846 109.274C650.846 126.279 664.631 140.064 681.636 140.064Z" fill="#FFB9B9"/>
            <path id="Vector_15" d="M653.31 87.177C653.31 87.177 704.577 122.509 718.433 106.575C732.288 90.6409 694.185 76.7851 694.185 76.7851L662.317 73.3212L653.31 87.177Z" fill="#2F2E41"/>
            </g>
            </g>
            </g>
            </g>
            <g id="passHand1">
            <path id="Vector_16" d="M573.655 463.042C578.932 466.97 585.46 468.839 592.016 468.298C598.572 467.757 604.706 464.843 609.267 460.104C613.829 455.364 616.505 449.123 616.795 442.551C617.084 435.98 614.967 429.528 610.84 424.405C606.713 419.283 600.859 415.841 594.376 414.726C587.893 413.61 581.226 414.898 575.624 418.346C570.022 421.795 565.871 427.169 563.947 433.459C562.024 439.75 562.461 446.526 565.176 452.518L494.47 511.39L485.055 500.217L480.825 503.046L476.118 497.459L479.986 494.2L475.278 488.613L469.262 493.683L472.159 497.121L465.712 502.552L462.816 499.114L453.361 507.08L457.706 512.237L461.144 509.34L465.851 514.927L461.554 518.548L470.244 528.862L459.93 537.553L470.431 550.015L573.655 463.042ZM591.309 423.55C594.833 423.851 598.188 425.19 600.951 427.398C603.714 429.606 605.759 432.584 606.83 435.955C607.9 439.325 607.947 442.938 606.964 446.335C605.981 449.733 604.013 452.762 601.309 455.041C598.604 457.32 595.284 458.745 591.77 459.138C588.255 459.53 584.703 458.871 581.562 457.244C578.422 455.618 575.834 453.096 574.127 449.999C572.42 446.902 571.669 443.368 571.97 439.844C572.374 435.119 574.638 430.747 578.265 427.692C581.892 424.636 586.584 423.146 591.309 423.55V423.55Z" fill="#3D3DB5"/>
            <path id="Vector_17" d="M583.953 221.506C583.953 221.506 588.802 285.243 587.417 288.014C586.031 290.785 587.417 387.083 587.417 387.083C587.417 387.083 577.718 439.043 590.188 441.814C602.658 444.585 599.887 383.619 599.887 383.619L612.357 303.256L610.972 223.585L583.953 221.506Z" fill="#FFB9B9"/>
            <path id="Vector_18" d="M594.345 181.324L588.802 183.403C588.802 183.403 578.41 227.049 581.182 227.049C583.953 227.049 617.207 231.205 617.207 229.82C617.207 228.434 610.972 194.487 610.972 194.487L594.345 181.324Z" fill="#3D3DB5"/>
            </g>
            </g>
        </svg>
    </body>
</html>
