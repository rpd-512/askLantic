<?php
require_once "libs.php";
session_start();
$cmnd = "";
$err = 0;
if (isset($_SESSION['cmnd'])) {
    $cmnd = $_SESSION['cmnd'];
    unset($_SESSION['cmnd']);
    if (strpos($cmnd, 'File')) {
        $err = 1;
    }
}
if (isset(isAuth()[1])) {
    $userData = isAuth()[1];
} else {
    header("Location: index.php");
}

if(isset($_POST['subm'])){
    if(str_replace(" ","",$_POST['desc']) == "" or str_replace(" ","",$_POST['ttle']) == "" or str_replace(" ","",$_POST['tags']) == "" or ! isValidTag($_POST['tags'])){header("Location: ask_question.php");exit();}
    $rawTagArr = explode(" ",$_POST['tags']);
    $tagArr = "";
    for($i = 0;$i < count($rawTagArr); $i++){
        if(str_replace(" ","",$rawTagArr[$i]) != ""){
            if(strlen($rawTagArr[$i]) > 50){header("Location: ask_question.php");exit();}
            $tagArr.=$rawTagArr[$i]." ";
        }
    }
    $rprt = array(
        "spm" => 0,
        "abs" => 0,
        "typ" => 0,
        "inv" => 0,
        'rptr' => ''
    );
    $qry = "insert into askLantic__questions (titl,ques,usrId,time,tags,rprt,view) VALUES (:ttl,:qst,:usr,:tme,:tgs,:jsn,0)";
    $raw_data = $pdo->prepare($qry);
    $raw_data->execute(array(
        ':ttl' => htmlentities($_POST["ttle"]),
        ':qst' => $_POST["desc"],
        ':tgs' => htmlentities($_POST["tags"]),
        ':usr' => $userData['userId'],
        ':jsn' => json_encode($rprt),
        ':tme' => time()
    ));
    header("Location: questions.php"."?q=".md5($pdo->lastInsertId()."QuestionOfFire@314159265"));
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>AskLantic || Ask your stuff here</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link href='https://fonts.googleapis.com/css?family=Days One' rel='stylesheet'>
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <link rel="stylesheet" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="js/index.js"></script>
    </head>
        <body onload="$('#ldScrn')[0].remove()">
        <div id='ldScrn'>
            <svg width="250" height="250" viewBox="0 0 604 603" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M302 603C468.514 603 603.5 468.014 603.5 301.5C603.5 134.986 468.514 0 302 0C135.486 0 0.5 134.986 0.5 301.5C0.5 468.014 135.486 603 302 603Z" fill="#3F3D56"/>
                <path opacity="0.05" d="M302 550.398C439.462 550.398 550.898 438.962 550.898 301.5C550.898 164.038 439.462 52.6021 302 52.6021C164.537 52.6021 53.1021 164.038 53.1021 301.5C53.1021 438.962 164.537 550.398 302 550.398Z" fill="black"/>
                <path opacity="0.05" d="M302 505.494C414.663 505.494 505.994 414.163 505.994 301.5C505.994 188.837 414.663 97.5064 302 97.5064C189.337 97.5064 98.0064 188.837 98.0064 301.5C98.0064 414.163 189.337 505.494 302 505.494Z" fill="black"/>
                <path opacity="0.05" d="M302 447.76C382.777 447.76 448.26 382.277 448.26 301.5C448.26 220.723 382.777 155.24 302 155.24C221.223 155.24 155.74 220.723 155.74 301.5C155.74 382.277 221.223 447.76 302 447.76Z" fill="black"/>
                <path d="M304.76 533.012C324.159 533.012 339.885 516.958 339.885 497.155C339.885 477.352 324.159 461.299 304.76 461.299C285.36 461.299 269.634 477.352 269.634 497.155C269.634 516.958 285.36 533.012 304.76 533.012Z" fill="#3895BF"/>
                <path d="M300.997 123.003C246.1 123.399 201.151 168.938 200.371 224.973C200.364 225.49 200.36 229.128 200.361 233.886C200.361 240.862 203.076 247.552 207.908 252.485C212.74 257.418 219.294 260.19 226.128 260.19C229.515 260.19 232.87 259.507 235.999 258.183C239.128 256.858 241.971 254.917 244.365 252.471C246.76 250.024 248.658 247.12 249.952 243.924C251.246 240.728 251.911 237.304 251.908 233.845C251.905 230.609 251.904 228.369 251.904 228.231C251.902 219.571 254.109 211.06 258.307 203.534C262.505 196.009 268.55 189.729 275.847 185.311C283.144 180.894 291.442 178.492 299.924 178.341C308.406 178.19 316.781 180.296 324.224 184.451C331.668 188.606 337.923 194.668 342.375 202.04C346.827 209.411 349.323 217.839 349.617 226.494C349.91 235.149 347.992 243.733 344.05 251.401C340.108 259.07 334.278 265.559 327.135 270.23L327.144 270.241C327.144 270.241 290.469 294.342 279.288 327.405L279.297 327.407C277.331 334.181 276.335 341.208 276.339 348.273C276.339 351.177 276.507 376.585 276.83 397.207C276.943 404.323 279.792 411.108 284.762 416.098C289.732 421.089 296.424 423.885 303.396 423.883C306.899 423.883 310.367 423.176 313.602 421.802C316.836 420.429 319.772 418.416 322.241 415.879C324.711 413.343 326.664 410.333 327.99 407.023C329.315 403.713 329.986 400.168 329.965 396.593C329.852 377.706 329.792 355.715 329.792 354.119C329.792 333.817 348.978 313.589 364.737 300.398C382.885 285.209 395.944 264.508 401.19 241.158C402.35 236.351 402.99 231.428 403.098 226.477C403.098 212.826 400.452 199.309 395.312 186.706C390.171 174.103 382.639 162.662 373.148 153.044C363.658 143.426 352.396 135.819 340.013 130.664C327.63 125.508 314.37 122.904 300.997 123.003Z" fill="#3895BF"/>
            </svg>
        </div>
    <div class="homeHead" style="height:120px;">
            <h1 onclick="location.href='index.php'" onmouseover="this.style.cursor='pointer'">AskLantic</h1>
            <p>Ask Question</p>
    </div>
    <div id="err" style="position:fixed;"></div>
    <div class="askQues">
        <form method="post" autocomplete="off">
            <label for="ttl">Title</label> <span class="wrdCnt">0/150</span><br>
            <input placeholder="Keep It Simple and Specific" spellcheck="true" title="be specific and short" id="ttl" name="ttle"/><span class="alrt">&#x26A0;</span><br>
            <label for="bdy">Description</label> <span class="wrdCnt">0/5000</span>
            <div class="btns">
                <button type="button" onclick="insrtInBdy('[B] insert text here [!]')"><b>B</b></button>
                <button type="button" onclick="insrtInBdy('[I] insert text here [!]')"><i>I</i></button>
                <button type="button" onclick="insrtInBdy('[U] insert text here [!]')"><u>U</u></button>
                <button type="button" onclick="insrtInBdy('[C] insert text here [!]')">&lt;Code&gt;</button>
                <button type="button" onclick="insrtInBdy('[>] insert text here [!]')">Quote</button>
            </div>
            <br>
            <textarea id="bdy" placeholder="Try to be as specific and polite as you can" rows="10" name="desc"></textarea><span class="alrt">&#x26A0;</span><br>
            <label for="prw">Preview</label><br>
            <div id="prw"></div><hr>
            <label for="tgs">Tags</label><span class="wrdCnt">0/5</span><br>
            <input id="tgs" name="tags" placeholder="Seperate tags with spaces"><span class="alrt">&#x26A0;</span>
            <div id="tags"></div>
            <hr>
            <input id="sbm" value="Submit Question" name="subm" type="submit" onclick="return submQues();">
            <input value="Home" type="button" onclick="if(confirm('Are you sure to leave the question like this? It won\' be saved')){location.href='index.php'}">
        </form>
    </div>
        
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="757.38 241.18 306.87 575.23" width="100px" height="300px" class="thinkChar">
        <g id="undraw_art_0tat 1">
            <g id="thinkBody">
                <g id="Group 7">
                    <path id="Vector" d="M882.868 305.864C882.868 305.864 903.869 326.443 877.935 342.37C859.674 353.585 922.051 333.631 922.051 333.631C922.051 333.631 909.084 300.508 911.058 292.897C913.031 285.286 882.868 305.864 882.868 305.864Z" fill="#FFB9B9"></path>
                    <g id="Group 6">
                        <path id="Vector_2" d="M925.613 732.767C925.613 732.767 933.143 765.53 944.872 772.591C956.6 779.652 916.245 793.042 916.245 793.042C916.245 793.042 898.681 803.93 894.119 807.868C889.556 811.805 870.005 820.228 873.227 813.972C876.45 807.716 882.112 795.819 891.052 785.935C899.992 776.051 911.746 758.356 901.507 744.575C891.268 730.794 925.613 732.767 925.613 732.767Z" fill="#FFB9B9"></path>
                        <path id="Vector_3" d="M884.841 334.195L880.895 332.785C880.895 332.785 870.747 331.376 861.444 343.216C852.141 355.055 830.858 390.997 830.858 390.997L822.965 409.602L850.873 410.448L871.874 364.217L884.841 334.195Z" fill="#FF6584"></path>
                        <path id="Vector_4" opacity="0.1" d="M884.841 334.195L880.895 332.785C880.895 332.785 870.747 331.376 861.444 343.216C852.141 355.055 830.858 390.997 830.858 390.997L822.965 409.602L850.873 410.448L871.874 364.217L884.841 334.195Z" fill="black"></path>
                        <path id="Vector_5" d="M880.613 620.459C880.613 620.459 896.54 623.983 893.862 636.246C891.184 648.508 910.494 664.435 912.326 667.113C914.158 669.791 916.836 670.919 915.145 675.006C913.454 679.094 954.469 736.741 946.294 741.956C938.12 747.171 871.874 767.609 865.954 763.521C860.035 759.434 855.242 625.674 855.242 625.674L880.613 620.459Z" fill="#2F2E41"></path>
                        <path id="Vector_6" opacity="0.1" d="M880.613 620.459C880.613 620.459 896.54 623.983 893.862 636.246C891.184 648.508 910.494 664.435 912.326 667.113C914.158 669.791 916.836 670.919 915.145 675.006C913.454 679.094 954.469 736.741 946.294 741.956C938.12 747.171 871.874 767.609 865.954 763.521C860.035 759.434 855.242 625.674 855.242 625.674L880.613 620.459Z" fill="black"></path>
                        <path id="Vector_7" d="M844.389 765.917C844.389 765.917 834.523 798.053 841.148 810.034C847.772 822.014 806.13 813.425 806.13 813.425C806.13 813.425 785.475 814.069 779.555 815.197C773.635 816.324 752.492 813.839 758.411 810.034C764.331 806.228 775.184 798.758 787.869 794.671C800.555 790.583 819.583 781.14 817.609 764.085C815.636 747.03 844.389 765.917 844.389 765.917Z" fill="#FFB9B9"></path>
                        <path id="Vector_8" d="M825.925 444.698C831.386 440.797 837.962 438.77 844.671 438.919C855.524 439.342 891.043 447.799 890.056 449.49C889.083 450.978 887.999 452.392 886.815 453.718C886.815 453.718 889.07 464.008 888.083 464.994C887.096 465.981 907.393 489.237 895.553 539.133C883.714 589.028 884.982 623.56 884.982 623.56C884.982 623.56 889.774 769.864 876.103 772.824C862.431 775.784 808.589 773.81 806.052 768.032C803.515 762.253 813.804 582.826 813.804 582.826C813.804 582.826 814.931 492.62 817.609 481.626C820.287 470.632 825.925 444.698 825.925 444.698Z" fill="#2F2E41"></path>
                        <path id="Vector_9" d="M888.083 338.001C888.083 338.001 917.259 324.61 922.051 329.403C926.844 334.195 947.563 353.928 925.011 388.883C902.46 423.838 898.09 450.054 894.285 453.014C890.479 455.974 888.083 449.208 888.083 449.208C888.083 449.208 877.089 439.201 869.901 439.201C862.713 439.201 831.986 442.584 831.986 442.584L840.584 408.474C840.584 408.474 836.355 381.553 850.732 368.163C865.109 354.773 880.895 332.785 880.895 332.785L889.036 331.298L883.66 338.144C883.66 338.144 882.868 340.256 888.083 338.001Z" fill="#FF6584"></path>
                        <g id="Group 5">
                            <path id="Vector_10" d="M888.475 600.582C901.27 578.86 918.207 562.165 938.817 550.959C960.609 539.106 976.512 497.555 972.572 491.415L966.248 483.009L1057.4 549.897L1057.53 550.468C1057.82 551.729 1064.2 581.931 1008.67 618.505C966.523 646.269 956.748 683.499 954.501 698.217C954.388 698.971 954.085 699.684 953.621 700.289C953.157 700.894 952.547 701.371 951.849 701.676C951.15 701.98 950.385 702.102 949.626 702.031C948.867 701.959 948.139 701.695 947.509 701.265L872.583 649.876C871.838 649.371 871.263 648.653 870.934 647.815C870.604 646.978 870.536 646.061 870.737 645.184C874.377 629.511 880.357 614.475 888.475 600.582Z" fill="#379FFF"></path>
                            <path id="Vector_11" d="M1063.29 548.12C1064.22 546.54 1064.48 544.657 1064.02 542.883C1063.57 541.109 1062.42 539.59 1060.84 538.659L860.263 420.507C858.684 419.577 856.8 419.312 855.026 419.771C853.251 420.23 851.732 421.375 850.802 422.954C849.872 424.533 849.607 426.417 850.066 428.191C850.525 429.966 851.67 431.485 853.249 432.415L1053.83 550.567C1055.41 551.495 1057.29 551.758 1059.07 551.299C1060.84 550.841 1062.36 549.697 1063.29 548.12Z" fill="#3F3D56"></path>
                        </g>
                        <path id="Vector_12" d="M820.992 412.421C820.992 412.421 808.448 429.335 816.764 435.677C825.08 442.02 842.557 431.167 842.557 431.167C842.557 431.167 882.868 459.215 882.304 442.725C881.741 426.234 852.846 414.817 852.846 414.817L833.395 415.381L836.355 405.655L828.18 404.81L820.992 412.421Z" fill="#FFB9B9"></path>
                        <path id="Vector_13" opacity="0.1" d="M820.992 412.421C820.992 412.421 808.448 429.335 816.764 435.677C825.08 442.02 842.557 431.167 842.557 431.167C842.557 431.167 882.868 459.215 882.304 442.725C881.741 426.234 852.846 414.817 852.846 414.817L833.395 415.381L836.355 405.655L828.18 404.81L820.992 412.421Z" fill="black"></path>
                    </g>
                </g>
                <path id="?" d="M982.872 584.301C986.23 586.741 987.751 590.441 987.435 595.403C987.125 600.398 985.507 604.911 982.579 608.94L980.104 612.347C971.838 623.724 963.291 626.205 954.462 619.79C952.487 618.355 951.12 616.623 950.362 614.593C949.609 612.598 949.349 610.629 949.583 608.687C949.803 606.764 950.109 604.889 950.502 603.062C950.879 601.254 951.055 599.601 951.027 598.102C951.005 596.637 950.628 595.639 949.897 595.108C948.475 594.075 948.202 592.956 949.077 591.751L953.92 585.085C954.308 584.552 954.799 584.23 955.393 584.118C955.992 584.04 956.549 584.188 957.062 584.561C958.761 585.796 960.025 587.212 960.855 588.811C961.685 590.41 962.114 591.959 962.142 593.457C962.189 594.971 962.13 596.527 961.964 598.126C961.783 599.745 961.559 601.197 961.29 602.48C960.686 605.512 961.175 607.602 962.755 608.75C964.335 609.898 965.905 610.209 967.464 609.682C969.01 609.175 970.636 607.747 972.344 605.396L973.442 603.885C975.824 600.607 976.238 597.482 974.684 594.512C973.473 592.275 973.513 590.267 974.805 588.489L977.366 584.964C978.069 583.996 978.96 583.496 980.039 583.465C981.118 583.434 982.062 583.713 982.872 584.301ZM946.768 576.177L948.634 577.533C949.938 578.48 950.677 579.56 950.852 580.773C951.026 581.987 950.662 583.216 949.758 584.46L947.11 588.104C946.206 589.348 945.15 590.075 943.942 590.284C942.734 590.493 941.478 590.123 940.175 589.176L938.308 587.82C937.044 586.902 936.315 585.829 936.121 584.601C935.946 583.388 936.311 582.159 937.215 580.915L939.862 577.27C940.766 576.026 941.822 575.3 943.03 575.091C944.258 574.896 945.504 575.258 946.768 576.177Z" fill="white"></path>
            </g>
            <g id="thinkHand">
                <path id="Vector_14" d="M914.871 372.801C914.871 372.801 835.658 433.832 830.584 412.408C827.286 398.484 829.823 364.2 832.003 341.901C833.562 325.666 840.812 310.505 852.472 299.1C857.225 294.47 861.633 291.565 863.848 293.73C870.049 299.79 849.33 324.033 849.33 324.033C849.33 324.033 845.947 373.224 852.713 378.862C852.713 378.862 877.223 355.195 882.305 355.541C887.386 355.888 914.871 372.801 914.871 372.801Z" fill="#FFB9B9"></path>
                <path id="Vector_15" d="M931.784 334.745C931.784 334.745 945.879 370.687 914.166 378.862C914.166 378.862 907.964 370.264 897.816 368.855C887.668 367.445 878.647 356.874 878.647 356.874C878.647 356.874 899.366 327.698 915.575 327.134C931.784 326.57 931.784 334.745 931.784 334.745Z" fill="#FF6584"></path>
            </g>
            <g id="thinkHead">
                <path id="Vector_16" d="M888.013 317.352C906.773 317.352 921.981 302.144 921.981 283.383C921.981 264.623 906.773 249.415 888.013 249.415C869.252 249.415 854.044 264.623 854.044 283.383C854.044 302.144 869.252 317.352 888.013 317.352Z" fill="#FFB9B9"></path>
                <path id="Vector_17" d="M957.607 315.146C951.118 305.378 945.76 289.668 939.979 275.831C938.105 271.347 936.393 266.804 934.717 262.242C931.339 253.048 916.632 241.18 897.37 241.18C875.355 241.18 857.508 252.258 857.508 261.554C857.508 269.239 869.712 275.716 886.38 277.731C880.524 290.802 876.996 305.309 876.996 315.146C876.996 337.406 895.041 327.991 917.301 327.991C939.561 327.991 969.924 333.688 957.607 315.146Z" fill="#2F2E41"></path>
            </g>
        </g>
    </svg>
    <script>
            var totTags;
            setInterval(() => {document.getElementsByClassName("wrdCnt")[0].innerHTML = ttl.value.length+"/"+"150";
            if(ttl.value.length > 150){document.getElementsByClassName("wrdCnt")[0].style.color="red"}
            else{document.getElementsByClassName("wrdCnt")[0].style.color="rgb(50,100,150)"}
            document.getElementsByClassName("wrdCnt")[1].innerHTML = bdy.value.replaceAll(" ","").replaceAll("\n","").length+"/"+"5000";
            if(bdy.value.length > 10000){document.getElementsByClassName("wrdCnt")[1].style.color="red"}
            else{document.getElementsByClassName("wrdCnt")[1].style.color="rgb(50,100,150)";prw.innerHTML=fltrDesc(bdy.value,true);}
            
            if(tgs.value.split(" ").length > 0){
                var tot = 0;
                tags.innerHTML = "";
                for(t of tgs.value.split(" ")){
                    if(t.replaceAll(" ","").length == 0){continue;}
                    tags.innerHTML += "<p class='tag'>"+htmlEntities(t)+"</p>";
                    tot += 1;
                }
                if(tgs.value.length == 0) tot=0;
                document.getElementsByClassName("wrdCnt")[2].innerHTML = tot+"/5";
                document.getElementsByClassName("wrdCnt")[2].style.color = "rgb(50,120,150)";
                if( tot > 5) document.getElementsByClassName("wrdCnt")[2].style.color = "red";
                totTags = tot;
            }
            },100)

            </script>
    <script>timeSpent();</script>
    </body>
</html>
